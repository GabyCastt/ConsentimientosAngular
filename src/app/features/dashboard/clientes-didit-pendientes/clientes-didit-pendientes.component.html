<div class="card mb-4 clientes-didit-card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">
      <i class="fas fa-fingerprint text-primary me-2"></i>
      Clientes DIDIT Pendientes
    </h5>
    <div>
      <span 
        class="badge me-2"
        [class.bg-warning]="getCantidadPendientes() > 0"
        [class.bg-success]="getCantidadPendientes() === 0">
        {{ getCantidadPendientes() }} pendiente{{ getCantidadPendientes() !== 1 ? 's' : '' }}
      </span>
      <button 
        class="btn btn-sm btn-outline-primary"
        (click)="actualizarManual()"
        [disabled]="loading()"
        title="Actualizar">
        <i class="fas fa-sync-alt" [class.fa-spin]="loading()"></i>
      </button>
    </div>
  </div>

  <div class="card-body">
    <!-- Loading State -->
    @if (loading() && clientes().length === 0) {
      <div class="text-center py-3">
        <div class="spinner-border spinner-border-sm text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <small class="text-muted ms-2">Cargando clientes pendientes...</small>
      </div>
    }

    <!-- Error State -->
    @if (error() && !loading()) {
      <div class="alert alert-warning">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <strong>Error cargando datos</strong><br>
        <small>
          No se pudieron cargar los clientes pendientes. 
          <a href="javascript:void(0)" (click)="cargarClientes()" class="alert-link">
            Intentar nuevamente
          </a>
        </small>
      </div>
    }

    <!-- Lista de Clientes -->
    @if (!loading() && !error() && clientes().length > 0) {
      <div class="clientes-lista">
        @for (cliente of getClientesMostrar(); track cliente.id) {
          <div class="cliente-item">
            <div class="row align-items-center">
              <div class="col-auto">
                <div class="cliente-avatar">
                  {{ getIniciales(cliente.nombre, cliente.apellido) }}
                </div>
              </div>
              <div class="col">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <h6 class="mb-1">{{ cliente.nombre }} {{ cliente.apellido }}</h6>
                    <small class="text-muted">
                      <i class="fas fa-id-card me-1"></i>{{ cliente.cedula }}
                      @if (cliente.email) {
                        <i class="fas fa-envelope ms-2 me-1"></i>{{ cliente.email }}
                      }
                    </small>
                    <br>
                    <span class="badge-tiempo">
                      <i class="fas fa-clock me-1"></i>
                      {{ formatearTiempoRelativo(cliente.fecha_verificacion) }}
                    </span>
                  </div>
                  <button 
                    class="btn btn-culminar-mini"
                    (click)="culminarProceso(cliente)"
                    [disabled]="loading()"
                    title="Culminar proceso">
                    @if (loading()) {
                      <i class="fas fa-spinner fa-spin"></i>
                    } @else {
                      <i class="fas fa-check me-1"></i>Culminar
                    }
                  </button>
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    }

    <!-- Estado Vacío -->
    @if (!loading() && !error() && clientes().length === 0) {
      <div class="text-center py-4 empty-state">
        <i class="fas fa-check-circle text-success fa-3x mb-3"></i>
        <h6>¡Todo al día!</h6>
        <p class="text-muted mb-0">No hay clientes pendientes de completar</p>
      </div>
    }

    <!-- Botón Ver Todos -->
    @if (hayMasClientes()) {
      <div class="text-center mt-3">
        <button 
          class="btn btn-primary"
          (click)="verPanelCompleto()">
          <i class="fas fa-external-link-alt me-1"></i>
          Ver Panel Completo
        </button>
      </div>
    }
  </div>
</div>
